[Unit]
Description=<%= fetch(:nginx_config_name) %> Puma Server
After=network.target

[Service]
Type=simple
User=deploy
WorkingDirectory=/var/www/<%= fetch(:nginx_config_name) %>/current
ExecStart=/home/deploy/.rvm/bin/rvm <%= RUBY_VERSION %> do bundle exec pumactl -S /var/www/<%= fetch(:nginx_config_name) %>/shared/tmp/pids/puma.state -F /var/www/<%= fetch(:nginx_config_name) %>/shared/puma.rb start
ExecStop=/home/deploy/.rvm/bin/rvm <%= RUBY_VERSION %> do bundle exec pumactl -S /var/www/<%= fetch(:nginx_config_name) %>/shared/tmp/pids/puma.state -F /var/www/<%= fetch(:nginx_config_name) %>/shared/puma.rb stop
TimeoutSec=45
Restart=always

[Install]
WantedBy=multi-user.target